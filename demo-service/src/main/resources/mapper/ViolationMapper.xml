<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.mapper.ViolationMapper">
    <!-- SQL：update，update 语句用于对应 Mapper 方法的数据访问。 -->
    <update id="update">
        UPDATE users
        <set>
            status =#{status},
            update_time = #{updateTime}
        </set>
        WHERE id = #{id}
    </update>


    <!-- SQL：SelectById，select 语句用于对应 Mapper 方法的数据访问。 -->
    <select id="SelectById" resultType="com.demo.entity.User">
        SELECT * FROM users WHERE id = #{userId}
    </select>


    <!-- 获取违规类型统计数据 -->
    <select id="getViolationStatistics" resultType="com.demo.dto.admin.ViolationStatisticsDTO">
        SELECT
            violation_type AS violationType,
            CAST(COUNT(*) AS SIGNED) AS cnt,
            CAST(COALESCE(SUM(credit), 0) AS SIGNED) AS creditSum
        FROM user_violations
        GROUP BY violation_type
        ORDER BY cnt DESC
    </select>

    <!-- SQL：getUserViolations，select 语句用于对应 Mapper 方法的数据访问。 -->
    <select id="getUserViolations" resultType="com.demo.dto.admin.UserViolationDTO">
        SELECT
            id,
            user_id AS userId,
            biz_id AS bizId,
            violation_type AS violationType,
            description,
            evidence,
            punish,
            credit,
            record_time AS recordTime,
            create_time AS createTime
        FROM user_violations
        WHERE user_id = #{userId}
        ORDER BY record_time DESC
    </select>



</mapper>
